---
title: DNS解析域名的速度与愿景
date: 2021-05-13 21:00:22
description: felix the cat
tags:
  - DNS解析
---

当深入研究DNS解析流程时，感觉其繁琐度有些类似于臃肿的政府办事流程。

这样的情景几乎每分每秒都在发生：有人在浏览器中输入或粘贴了一个地址，并按下了回车键。接下来的1-5秒内，他们期待看到页面展示，如果超过5秒，他们可能会刷新页面或者直接关闭页面离开。在这短暂的瞬间，我们的应用程序需要进行一系列循环往复的操作。

当按下回车键后，本地解析器首先会将用户输入的地址解析为对应的IP地址。这个过程涉及到查询本地缓存、操作系统的解析机制，甚至可能需要进行递归的DNS解析。解析器将尝试找到对应的IP地址，以便后续建立与服务器的连接。以`kiera.site`作为例子，下面我们来分解这个步骤。

### 查询本地缓存
操作系统首先检查其本地 DNS 缓存，看看是否知道 `kiera.site` 的 IP 地址。如果是，它将从该地址请求该站点。如果没有，就会向一个递归解析器服务发起查询请求，这个递归解析器服务通常由`ISP(Internet service provider)`或者第三方网络供应商提供。我们管它叫`本地DNS解析器`,它首先也会查看自身是否有缓存，有就直接返回，没有的话就进行下一步：和`DNS服务器`打交道。

### DNS解析
第一步，要先找根域名服务器拿到`顶级域名服务器(TLD，Top-Level Domain)`。根域名服务器是DNS解析的起点，全球共有13个分布在世界各地，而本地解析器随机选择其中一个发起请求，获取目标域名的`TLD`。

第二步，向这个`TLD`发请求。`TLD`是管理特定顶级域（例如.com、.net等）的服务器，它保存着二级域名的DNS记录，如"xxx.com"。这一步，本地解析器获取到该域名的`权威域名服务器(authoritative nameserver)`。

第三步，本地解析器向`权威域名服务器`发请求。`权威域名服务器`是负责管理特定域名解析的服务器。它保存了目标域名的DNS记录，包括主机名（www）、IP地址等。现在，本地解析器终于拿到了目标域名的IP地址了！

### TCP连接
一旦解析器获得了目标服务器的IP地址，它会建立与服务器的TCP连接，并发送HTTP请求。这个请求包含了用户的具体需求，比如请求访问特定的页面或者获取特定的资源。然后，服务器接收到请求并进行相应的处理，返回相应的数据。

在这弹指一瞬间，本地解析器承担着重要的任务，不断地查询、连接、发送请求，并等待服务器的响应。它的工作紧张而辛苦，就像要跑断腿一样。这些看似微小的操作背后，却是一个复杂而庞大的网络生态系统。每一个环节都需要高效运作，以确保用户能够在最短的时间内获得所需的信息。

或许有一天，我们会拥有更快、更高效的应用程序解析和交互体验，会有更多创新的解决方案，让我们的应用程序能够以更快的速度响应用户的需求。